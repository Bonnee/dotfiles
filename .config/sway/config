 # i3 config file (v4)

include "$HOME/.cache/wal/colors-sway"

#################################################
#####               Variables               #####
#################################################

output eDP-1 scale 1 subpixel rgb enable

output "*" bg $wallpaper fill

set $trans D9

set $mod Mod4
set $fn Menu

#set $term kitty
set $term alacritty --config-file ~/.config/alacritty/`hostname`.yml

input type:touchpad {
  pointer_accel 0.15
  tap enabled
  drag_lock enabled
  click_method clickfinger
  middle_emulation enabled
  dwt disabled
}

input type:keyboard {
  xkb_options ctrl:swapcaps
  xkb_layout it
  xkb_numlock enabled
}

set $fontfam    sans-serif
set $fontsize   14

set $browser firefox

font pango: $fontfam $fontsize
# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod
focus_follows_mouse yes
#workspace_auto_back_and_forth yes

force_display_urgency_hint 500 ms
popup_during_fullscreen smart

default_border pixel 4
hide_edge_borders smart

#################################################
#####              Keystrokes               #####
#################################################
# start a terminal
bindsym $mod+Return exec $term

# kill focused window
bindsym $mod+q kill

set $bemenu "bemenu -bi -p '> ' --fn 'Noto Sans 12' --tb '$background' --fb '$background' --nb '$background' --hb '$foreground' --sb '$background' --scb '$background' --tf '$foreground' --ff '$foreground' --nf '$foreground' --hf '$background' --sf '$foreground' --scf '$foreground'"
bindsym $mod+d exec unset SHELL && j4-dmenu-desktop --term "$term" --usage-log "$HOME/.config/j4-dmenu-usage" --no-generic --dmenu "bemenu" | xargs swaymsg exec --

# change focus
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# move focused window
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

# split in horizontal orientation
bindsym $mod+b split h

# split in vertical orientation
bindsym $mod+v split v

# enter fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
#bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# toggle tiling / floating
bindsym $mod+space floating toggle

# change focus between tiling / floating windows
bindsym $mod+Shift+space focus mode_toggle

# switch to workspace
bindsym $mod+1 workspace 1
bindsym $mod+2 workspace 2
bindsym $mod+3 workspace 3
bindsym $mod+4 workspace 4
bindsym $mod+5 workspace 5
bindsym $mod+6 workspace 6
bindsym $mod+7 workspace 7
bindsym $mod+8 workspace 8
bindsym $mod+9 workspace 9
bindsym $mod+0 workspace 10

bindsym $mod+Tab workspace next
bindsym $mod+Shift+Tab workspace prev

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace 1
bindsym $mod+Shift+2 move container to workspace 2
bindsym $mod+Shift+3 move container to workspace 3
bindsym $mod+Shift+4 move container to workspace 4
bindsym $mod+Shift+5 move container to workspace 5
bindsym $mod+Shift+6 move container to workspace 6
bindsym $mod+Shift+7 move container to workspace 7
bindsym $mod+Shift+8 move container to workspace 8
bindsym $mod+Shift+9 move container to workspace 9
bindsym $mod+Shift+0 move container to workspace 10
bindsym $mod+less workspace back_and_forth
bindsym $mod+Shift+greater move container to workspace back_and_forth; workspace back_and_forth

# reload the configuration file
bindsym $mod+Shift+c reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart

bindswitch --locked lid:on output eDP-1 disable
bindswitch --locked lid:off output eDP-1 enable

bindsym --locked XF86MonBrightnessUp exec flock -n /tmp/backlight.lock brillo -u 100000 -A 5 && brillo | awk '{print int($1+0.5)}' > $SWAYSOCK.wob
bindsym --locked XF86MonBrightnessDown exec flock -n /tmp/backlight.lock brillo -u 100000 -U 5 && brillo | awk '{print int($1+0.5)}' > $SWAYSOCK.wob
bindsym XF86Bluetooth exec notify-send -t 1000 -u low "¯\_(ツ)_/¯"
bindsym XF86Display exec wdisplays

set $volume_up volume.sh -gs +2% > $SWAYSOCK.wob
set $volume_down volume.sh -gs -2% > $SWAYSOCK.wob
set $volume_mute volume.sh -gm > $SWAYSOCK.wob

bindsym --locked XF86AudioRaiseVolume exec $volume_up
bindsym --locked $fn+Page_Up exec $volume_up

bindsym --locked XF86AudioLowerVolume exec $volume_down
bindsym --locked $fn+Page_Down exec $volume_down

bindsym --locked XF86AudioMute exec $volume_mute
bindsym --locked $fn+Delete exec $volume_mute

bindsym --locked XF86AudioMicMute exec volume.sh -i

set $song_playpause playerctl play-pause
set $song_next playerctl next
set $song_prev playerctl previous

bindsym --locked XF86AudioPlay exec $song_playpause
bindsym --locked XF86AudioPause exec $song_playpause
bindsym --locked $fn+Insert exec $song_playpause

bindsym --locked XF86AudioNext exec $song_next
bindsym --locked $fn+Home exec $song_next

bindsym --locked $fn+End exec $song_prev
bindsym --locked XF86AudioPrev exec $song_prev

bindsym --locked XF86AudioStop exec playerctl stop

set $screenshot "$(xdg-user-dir PICTURES)/screenshot-$(date +%F_%T).png" && notify-send -t 1000 -u critical "Screenshot Taken!"

bindsym $mod+Print exec grimshot copy screen
bindsym $mod+Shift+Print exec grimshot copy area

bindsym $mod+Ctrl+Print exec grimshot save screen
bindsym $mod+Ctrl+Shift+Print exec grimshot save area

bindsym $mod+c exec $browser

bindsym $mod+g exec thunar
bindsym $mod+a exec telegram-desktop

#################################################
#####          Scratchpad settings          #####
#################################################

# Keystrokes to show various marks
bindsym $mod+s [con_mark="scratch"] scratchpad show

# General "Move to scratchpad" keystroke
bindsym $mod+Shift+s mark "scratch", move scratchpad

# Automatically move Spotify to scratchpad
for_window [class="Spotify"] mark "music", move scratchpad, resize set width 1600 height 900  [con_mark="music"] scratchpad show
for_window [app_id="spotify"] mark "music", move scratchpad, resize set width 1600 height 900, [con_mark="music"] scratchpad show
bindsym $mod+x [con_mark="music"] scratchpad show

# Move dropterm to scratchpad
for_window [app_id="dropterm"] mark "dropterm", move scratchpad
bindsym $mod+t [con_mark="dropterm"] scratchpad show
exec sh -c 'while [ -S "$SWAYSOCK" ]; do $term --class dropterm; done'

# Math pad
for_window [app_id="math"] mark "math", move scratchpad
bindsym $mod+r [con_mark="math"] scratchpad show
exec sh -c 'while [ -S "$I3SOCK" ]; do $term --class math,math -e qalc; done'

#################################################
#####                 Modes                 #####
#################################################

set $mode_system System (l) lock, (e) exit, (s) suspend, (h) hibernate, (r) reboot, (Shift+s) shutdown
bindsym $mod+Escape mode "$mode_system"

mode "$mode_system" {
  bindsym l exec lockw.sh, mode "default"
  bindsym e exit, mode "default"
  bindsym s exec systemctl suspend, mode "default"
  bindsym h exec systemctl hibernate, mode "default"
  bindsym r exec systemctl reboot, mode "default"
  bindsym Shift+s exec systemctl poweroff -i, mode "default"
  
  # back to normal: Enter or Escape
  bindsym Return mode "default"
  bindsym Escape mode "default"
}


set $exit Exit sway? (y/n)
bindsym $mod+Shift+e mode "$exit"
mode "$exit" {
  bindsym y exit
  bindsym n mode "default"
  bindsym Escape mode "default"
}

#################################################
#####          Windows Preferences          #####
#################################################

# Window Colors
# class                 border		  backgr.	    text        indicator	  child_border
client.focused		$foreground	  $foreground	    $background $color4		  $foreground
client.focused_inactive $color8		  $color8	    $foreground $color8		  $color8
client.unfocused	$background$trans $background$trans $foreground $background$trans $background$trans
client.urgent           $color6		  $color6	    $background $color6		  $color6
client.background       $background


include ~/.config/sway/config.d/*

#################################################
#####                Autorun                #####
#################################################

bar {
  swaybar_command waybar
}

exec xsettingsd -c "$HOME/.config/xsettingsd/`hostname`.conf"

#exec_always import-gsettings \
#    gtk-theme:gtk-theme-name \
#    icon-theme:gtk-icon-theme-name \
#    font-name:gtk-font-name \
#    cursor-theme:gtk-cursor-theme-name \
#    font-name:gtk-font-name \
#    monospace-font-name:gtk-monospace-font-name

exec sh -c 'while [ -S "$SWAYSOCK" ]; do rm $SWAYSOCK.wob; mkfifo $SWAYSOCK.wob && tail -f $SWAYSOCK.wob | wob -abottom -M10 -o2 -b3 -p0; done'
exec --no-startup-id mako
exec --no-startup-id kanshi
exec --no-startup-id ydotoold

# --indicator for AppIndicator branch
exec nm-applet --indicator

# Let root run X apps
exec --no-startup-id xhost +SI:localuser:root

exec --no-startup-id swayidle -dw \
    timeout 120 'brillo -O; brillo -u 1000000 -S 5' \
    resume 'swaymsg "output * dpms on"; brillo -u 250000 -I' \
    timeout 210 'brillo -u 1000000 -S 0; lockw.sh; swaymsg "output * dpms off"' \
    timeout 30 'if pgrep swaylock; then swaymsg "output * dpms off"; fi' \
    resume 'if pgrep swaylock; then swaymsg "output * dpms on"; fi' \
    before-sleep 'playerctl pause; brillo -O; brillo -u 500000 -S 0; lockw.sh' \
    after-resume 'swaymsg "output * dpms on"; brillo -u 250000 -I' \
    lock 'lockw.sh'

# Autostart
exec --no-startup-id dex -a


